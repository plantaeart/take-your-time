<div id="products-display-container" class="products-container">
  <!-- Loading State -->
  @if (productList.isLoading()) {
    <div id="products-display-loading-grid" class="products-grid">
      @for (i of [1,2,3,4,5,6,7,8]; track i) {
        <p-card class="product-card">
          <ng-template pTemplate="header">
            <p-skeleton width="100%" height="200px"></p-skeleton>
          </ng-template>
          <p-skeleton width="100%" height="1.5rem" styleClass="mb-2"></p-skeleton>
          <p-skeleton width="80%" height="1rem" styleClass="mb-3"></p-skeleton>
          <p-skeleton width="60%" height="1rem" styleClass="mb-3"></p-skeleton>
          <div class="flex justify-content-between align-items-center">
            <p-skeleton width="80px" height="2rem"></p-skeleton>
            <div class="flex gap-2">
              <p-skeleton width="40px" height="2rem"></p-skeleton>
              <p-skeleton width="40px" height="2rem"></p-skeleton>
            </div>
          </div>
        </p-card>
      }
    </div>
  }

  <!-- Error State -->
  @if (productList.errorMessage()) {
    <div id="products-display-error-container" class="error-container">
      <div class="error-message">
        <i class="pi pi-exclamation-triangle"></i>
        <h3>Failed to load products</h3>
        <p>{{ productList.errorMessage() }}</p>
        <p-button 
          id="products-display-retry-btn"
          label="Try Again" 
          icon="pi pi-refresh" 
          (onClick)="productList.refresh()">
        </p-button>
      </div>
    </div>
  }

  <!-- Products Grid -->
  @if (productList.hasProducts() && !productList.isLoading()) {
    <div id="products-display-grid" class="products-grid">
      @for (product of productList.products(); track product.id) {
        <p-card [id]="'product-card-' + product.id" class="product-card">
          <!-- Product Image -->
          <ng-template pTemplate="header">
            <div class="product-image-container">
              <img 
                [id]="'product-image-' + product.id"
                [src]="product.image || defaultImage" 
                [alt]="product.name"
                class="product-image"
                (error)="onImageError($event)">
              
              <!-- Stock Status Badge -->
              <div class="stock-badge">
                <p-tag 
                  [id]="'product-stock-' + product.id"
                  [value]="getStockConfig(product.inventoryStatus).label"
                  [severity]="getStockConfig(product.inventoryStatus).severity">
                </p-tag>
              </div>
            </div>
          </ng-template>

          <!-- Product Information -->
          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            
            <!-- Category Tag -->
            <div class="category-tag">
              <p-tag 
                [value]="getCategoryConfig(product.category).label"
                [severity]="getCategoryConfig(product.category).severity">
              </p-tag>
            </div>
            
            <p class="product-description">
              {{ product.description }}
            </p>

            <div class="product-details">
              <div class="quantity-info">
                <i class="pi pi-box"></i>
                <span>{{ product.quantity }}</span>
              </div>

              <div class="price">
                {{ formatPrice(product.price) }}
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <ng-template pTemplate="footer">
            <div class="product-actions">
              <p-button 
                [id]="'product-wishlist-btn-' + product.id"
                icon="pi pi-heart"
                severity="secondary"
                [outlined]="true"
                size="small"
                pTooltip="Add to Wishlist"
                tooltipPosition="top"
                (onClick)="onAddToWishlist(product)">
              </p-button>

              <!-- Quantity and Add to Cart Section -->
              <div class="cart-section">
                @if (canAddToCart(product)) {
                  <div class="quantity-controls">
                    <p-inputNumber
                      [id]="'product-quantity-' + product.id"
                      [ngModel]="getAddQuantity(product.id!)"
                      (ngModelChange)="setAddQuantity(product.id!, $event)"
                      [min]="1"
                      [max]="getMaxAddQuantity(product)"
                      [showButtons]="true"
                      buttonLayout="horizontal"
                      size="small"
                      [disabled]="cart.isLoading()"
                      inputStyleClass="w-3rem text-center">
                    </p-inputNumber>
                  </div>
                }

                <p-button 
                  [id]="'product-add-to-cart-btn-' + product.id"
                  [label]="canAddToCart(product) ? 'Add to Cart' : 'Out of Stock'"
                  icon="pi pi-shopping-cart"
                  size="small"
                  [disabled]="!canAddToCart(product) || cart.isLoading()"
                  [loading]="cart.isLoading()"
                  (onClick)="onAddToCart(product)">
                </p-button>
              </div>
            </div>
          </ng-template>
        </p-card>
      }
    </div>

    <!-- Show More Button -->
    @if (productList.canLoadMore()) {
      <div id="products-display-pagination-container" class="show-more-container">
        <p-button 
          id="products-display-show-more-btn"
          label="Show More Products"
          icon="pi pi-angle-down"
          [loading]="productList.isLoadingMore()"
          severity="secondary"
          [outlined]="true"
          size="large"
          (onClick)="onShowMore()">
        </p-button>
        
        @if (productList.totalProducts() > 0) {
          <p id="products-display-pagination-info" class="pagination-info">
            Showing {{ productList.totalProducts() }} products
          </p>
        }
      </div>
    } @else {
      <!-- No More Products Message -->
      @if (productList.totalProducts() > 0) {
        <div id="products-display-all-loaded-container" class="show-more-container">
          <p id="products-display-all-loaded-message" class="pagination-info no-more-products">
            <i class="pi pi-check-circle"></i>
            All products loaded ({{ productList.totalProducts() }} total)
          </p>
        </div>
      }
    }
  }

  <!-- Empty State -->
  @if (!productList.hasProducts() && !productList.isLoading() && !productList.errorMessage()) {
    <div id="products-display-empty-state" class="empty-state">
      <div class="empty-message">
        <i class="pi pi-inbox"></i>
        <h3>No products available yet</h3>
        <p>We're working on adding products to our catalog. Please check back soon!</p>
        <p-button 
          id="products-display-empty-refresh-btn"
          label="Refresh" 
          icon="pi pi-refresh" 
          severity="secondary"
          [outlined]="true"
          (onClick)="productList.refresh()">
        </p-button>
      </div>
    </div>
  }

  <!-- Top Page Button -->
  <app-top-page 
    [scrollThreshold]="300" 
    scrollContainer=".products-container">
  </app-top-page>
</div>
