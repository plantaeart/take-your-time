<div class="filter-container">
  <!-- Filter Header -->
  <div class="filter-header" (click)="toggleExpansion()">
    <h3 class="filter-title">{{ title }}</h3>
    <div class="filter-actions">
      @if (hasActiveFilters()) {
        <small class="active-count">
          {{ getActiveFilterCount() }} filter(s) active
        </small>
      }
      @if (showClearButton) {
        <p-button 
          label="Clear All"
          icon="pi pi-times"
          severity="secondary"
          [text]="true"
          size="small"
          [disabled]="!hasActiveFilters()"
          (click)="onClearFilters(); $event.stopPropagation()">
        </p-button>
      }
      <!-- Expand/Collapse Button -->
      <p-button 
        [icon]="isExpanded() ? 'pi pi-chevron-up' : 'pi pi-chevron-down'"
        severity="secondary"
        [text]="true"
        size="small"
        [pTooltip]="isExpanded() ? 'Collapse filters' : 'Expand filters'"
        tooltipPosition="top"
        (click)="toggleExpansion(); $event.stopPropagation()">
      </p-button>
    </div>
  </div>

  <!-- Filter Content - Expandable -->
  @if (isExpanded()) {
    <div class="filter-content">
      <!-- Category Filter -->
      @if (config.showCategories !== false) {
        <div class="filter-section">
          <label class="filter-label">Categories</label>
          <p-multiSelect 
            [options]="categoryOptions"
            [(ngModel)]="selectedCategories"
            (onChange)="onCategoryChange($event.value)"
            (onClear)="onCategoryChange([])"
            optionLabel="label"
            optionValue="value"
            placeholder="Select categories"
            [showClear]="true"
            [filter]="true"
            [maxSelectedLabels]="3"
            selectedItemsLabel="categories selected"
            styleClass="category-multiselect filter-select">
            
            <!-- Custom option template with colored badges -->
            <ng-template pTemplate="item" let-option>
              <div class="category-option">
                <span 
                  class="category-badge" 
                  [style.background-color]="option.color">
                </span>
                <span class="category-label">{{ option.label }}</span>
              </div>
            </ng-template>
            
            <!-- Custom selected item template -->
            <ng-template pTemplate="selectedItem" let-option>
              <div class="selected-category-item">
                <span 
                  class="category-badge-small" 
                  [style.background-color]="option.color">
                </span>
                <span>{{ option.label }}</span>
              </div>
            </ng-template>
          </p-multiSelect>
        </div>
      }

      <!-- Inventory Status Filter -->
      @if (config.showInventoryStatus) {
        <div class="filter-section">
          <label class="filter-label">Stock Status</label>
          <p-multiSelect 
            [options]="inventoryStatusOptions"
            [(ngModel)]="selectedInventoryStatuses"
            (onChange)="onInventoryStatusChange($event.value)"
            (onClear)="onInventoryStatusChange([])"
            optionLabel="label"
            optionValue="value"
            placeholder="Select stock status"
            [showClear]="true"
            [maxSelectedLabels]="2"
            selectedItemsLabel="statuses selected"
            styleClass="filter-select">
            
            <!-- Custom option template with colored badges -->
            <ng-template pTemplate="item" let-option>
              <div class="status-option">
                <span 
                  class="category-badge" 
                  [style.background-color]="option.color">
                </span>
                <span class="category-label">{{ option.label }}</span>
              </div>
            </ng-template>
            
            <!-- Custom selected item template -->
            <ng-template pTemplate="selectedItem" let-option>
              <div class="selected-category-item">
                <span 
                  class="category-badge-small" 
                  [style.background-color]="option.color">
                </span>
                <span>{{ option.label }}</span>
              </div>
            </ng-template>
          </p-multiSelect>
        </div>
      }

      <!-- Price Range Filter -->
      @if (config.showPriceRange) {
        <div class="filter-section">
          <label class="filter-label">Price Range</label>
          <div class="price-filter">
            <!-- Price Range Slider -->
            <div class="price-slider">
              <p-slider 
                [(ngModel)]="priceSliderValues"
                (onSlideEnd)="onPriceSliderChange(priceSliderValues)"
                [range]="true"
                [min]="config.priceMin || 0"
                [max]="config.priceMax || 1000"
                [step]="10"
                styleClass="w-full">
              </p-slider>
              <div class="price-display">{{ getPriceRangeDisplay() }}</div>
            </div>
          </div>
        </div>
      }

      <!-- Sort Options with SelectButton -->
      @if (config.showSorting) {
        <div class="filter-section sort-section">
          <label class="filter-label">Sort By</label>
          <p-selectButton 
            [options]="sortOptions"
            [(ngModel)]="selectedSort"
            (onChange)="onSortChange(selectedSort)"
            optionLabel="label"
            optionValue="value"
            [allowEmpty]="true"
            styleClass="sort-select-button">
            
            <!-- Custom option template with icons -->
            <ng-template pTemplate="item" let-option let-index="index">
              <div class="sort-option">
                <i class="pi" 
                   [class]="option.order === 'asc' ? 'pi-sort-amount-up' : 'pi-sort-amount-down'">
                </i>
                <span class="sort-label">{{ option.label }}</span>
              </div>
            </ng-template>
          </p-selectButton>
        </div>
      }
    </div>
  }
</div>
